<div id="cart-container">
  <div class="d-flex align-items-center mb-3">
    <a href="javascript:history.back()" class="btn btn-secondary me-3">‚Üê –ù–∞–∑–∞–¥</a>
    <h3 class="mb-0">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h3>
  </div>
  {% if items %}
    <ul class="list-group mb-3">
      {% for item in items %}
        <li class="list-group-item d-flex align-items-center flex-wrap">
          <div class="d-flex align-items-center flex-grow-1" style="min-width:0;">
            {% if item.product.image %}
            <img src="{{ item.product.image }}" alt="{{ item.product.name }}" class="me-3" style="width:50px;height:50px;object-fit:cover;border-radius:8px;">
            {% endif %}
            <div>
              <div class="fw-semibold">{{ item.product.name }}</div>
              <small class="text-muted">{{ "%.2f"|format(item.product.price) }} ‚ÇΩ/—à—Ç.</small>
            </div>
          </div>

          <div class="input-group input-group-sm cart-qty flex-nowrap ms-3">
            <button type="button" class="btn btn-outline-secondary qty-btn"
                    aria-label="–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"
                    hx-post="/{{ salon_slug }}/cart/decrease/{{ item.product.id }}"
                    hx-target="#cart-container"
                    hx-swap="outerHTML"
                    hx-sync="closest li:queue"
                    hx-on="
                      htmx:before-request: this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=true);
                      htmx:beforeRequest: this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=true);
                      htmx:after-request:  this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=false);
                      htmx:afterRequest:  this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=false);
                    ">
              <span aria-hidden="true">&minus;</span><span class="visually-hidden">–ú–∏–Ω—É—Å</span>
            </button>

            <input type="number" class="form-control text-center qty-input"
                   value="{{ item.quantity }}" min="1" readonly
                   aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ {{ item.product.name }}">

            <button type="button" class="btn btn-outline-secondary qty-btn"
                    aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"
                    hx-post="/{{ salon_slug }}/cart/increase/{{ item.product.id }}"
                    hx-target="#cart-container"
                    hx-swap="outerHTML"
                    hx-sync="closest li:queue"
                    hx-on="
                      htmx:before-request: this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=true);
                      htmx:beforeRequest: this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=true);
                      htmx:after-request:  this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=false);
                      htmx:afterRequest:  this.closest('.cart-qty').querySelectorAll('button').forEach(b=>b.disabled=false);
                    ">
              <span aria-hidden="true">+</span><span class="visually-hidden">–ü–ª—é—Å</span>
            </button>
          </div>

          <span class="fw-semibold text-nowrap ms-auto">{{ "%.2f"|format(item.product.price * item.quantity) }} ‚ÇΩ</span>
        </li>
      {% endfor %}
    </ul>

    <p class="fw-bold text-end" aria-live="polite">–ò—Ç–æ–≥–æ: {{ "%.2f"|format(total) }} ‚ÇΩ</p>
    <a href="/{{ salon_slug }}/checkout" class="btn btn-success w-100">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</a>
  {% else %}
    <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
  {% endif %}
</div>

{% include "_cart_counts_oob.htm" %}

<style>
  /* –ù–µ –¥–∞—ë–º –≥—Ä—É–ø–ø–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
  .cart-qty {
    flex-wrap: nowrap !important;
    min-width: 140px; /* –∑–∞–ø–∞—Å –ø–æ–¥ 2‚Äì3 –∑–Ω–∞–∫–∞ */
  }
  .cart-qty .qty-btn {
    flex: 0 0 40px;
    width: 40px;
    height: 32px; /* –ø–æ–¥ input-group-sm */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    line-height: 1; /* —á—Ç–æ–±—ã :active –Ω–µ —Å–¥–≤–∏–≥–∞–ª */
  }
  .cart-qty .qty-input {
    flex: 0 0 56px;
    max-width: 56px;
    text-align: center;
  }
  .cart-qty .qty-input::-webkit-outer-spin-button,
  .cart-qty .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .cart-qty .qty-input[type="number"] { -moz-appearance: textfield; }
</style>